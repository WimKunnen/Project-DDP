.text

.global asm_cond_sub
.func asm_cond_sub, asm_cond_sub
.type asm_cond_sub, %function

// initial params
// r0: u
// r1: n
// r2: size
// r3: t
// r4: index
// r5: u[index]
// r6: n[index]
// r7: b
asm_cond_sub:

push {r4,r5,r6,r7,r8}
mov r4, #0
mov r7, #0
cmp r4, r2
bge end

// r5: &t + offset
mov r5, #0
init_loop:
	str	r4, [r3,r5]
	add r5, r5, #4
	cmp r5, r2
	blt init_loop

sub_loop:
	ldr r5, [r0, r4]
	ldr r6, [r1, r4]
	sub r8, r5, r6
	sub r8, r8, r7
	mov r7, #0
	movcc r7, #1

	str r8, [r3, r4, lsl #2]
	add r4, #1
	cmp r4, r2
	blt sub_loop

	ldr r5, [r0, r3, lsl #2]
	str r6, [r3, r2, lsl #2]

	cmp r7, #0
	bne end
	mov r4, #0
	cmp r4, r2
	bgt end

	final_loop:
		ldr r5, [r3, r4]
		str r5, [r0, r4, lsl #2]
		add r4, #1
		cmp r4, r2
		ble final_loop

end:
pop {r4,r5,r6,r7,r8}
bx lr
.endfunc
